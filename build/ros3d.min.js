var ROS3D=function(e){"use strict";var t=function(e,t){var s=new THREE.Vector3;s.subVectors(e.origin,t.origin);var i=t.direction.clone(),o=e.direction.clone(),r=s.dot(i),n=i.dot(o),a=s.dot(o),c=i.dot(i),h=o.dot(o)*c-n*n;if(!(Math.abs(h)<=1e-4))return(r*n-a*c)/h};class s extends THREE.Object3D{constructor(e){super(),e=e||{},this.url=e.url,this.streamType=e.streamType||"vp8",this.f=e.f||526,this.maxDepthPerTile=e.maxDepthPerTile||1,this.pointSize=e.pointSize||3,this.width=e.width||1024,this.height=e.height||1024,this.resolutionFactor=Math.max(this.width,this.height)/1024,this.whiteness=e.whiteness||0,this.varianceThreshold=e.varianceThreshold||16667e-9,this.isMjpeg="mjpeg"===this.streamType.toLowerCase(),this.video=document.createElement(this.isMjpeg?"img":"video"),this.video.crossOrigin="Anonymous",this.video.addEventListener(this.isMjpeg?"load":"loadedmetadata",this.metaLoaded.bind(this),!1),this.isMjpeg||(this.video.loop=!0),this.video.src=this.url,this.video.setAttribute("crossorigin","Anonymous"),this.vertex_shader=["uniform sampler2D map;","","uniform float width;","uniform float height;","uniform float nearClipping, farClipping;","","uniform float pointSize;","uniform float zOffset;","","uniform float focallength;","uniform float maxDepthPerTile;","uniform float resolutionFactor;","","varying vec2 vUvP;","varying vec2 colorP;","","varying float depthVariance;","varying float maskVal;","","float sampleDepth(vec2 pos)","  {","    float depth;","    ","    vec2 vUv = vec2( pos.x / (width*2.0), pos.y / (height*2.0)+0.5 );","    vec2 vUv2 = vec2( pos.x / (width*2.0)+0.5, pos.y / (height*2.0)+0.5 );","    ","    vec4 depthColor = texture2D( map, vUv );","    ","    depth = ( depthColor.r + depthColor.g + depthColor.b ) / 3.0 ;","    ","    if (depth>0.99)","    {","      vec4 depthColor2 = texture2D( map, vUv2 );","      float depth2 = ( depthColor2.r + depthColor2.g + depthColor2.b ) / 3.0 ;","      depth = 0.99+depth2;","    }","    ","    return depth;","  }","","float median(float a, float b, float c)","  {","    float r=a;","    ","    if ( (a<b) && (b<c) )","    {","      r = b;","    }","    if ( (a<c) && (c<b) )","    {","      r = c;","    }","    return r;","  }","","float variance(float d1, float d2, float d3, float d4, float d5, float d6, float d7, float d8, float d9)","  {","    float mean = (d1 + d2 + d3 + d4 + d5 + d6 + d7 + d8 + d9) / 9.0;","    float t1 = (d1-mean);","    float t2 = (d2-mean);","    float t3 = (d3-mean);","    float t4 = (d4-mean);","    float t5 = (d5-mean);","    float t6 = (d6-mean);","    float t7 = (d7-mean);","    float t8 = (d8-mean);","    float t9 = (d9-mean);","    float v = (t1*t1+t2*t2+t3*t3+t4*t4+t5*t5+t6*t6+t7*t7+t8*t8+t9*t9)/9.0;","    return v;","  }","","vec2 decodeDepth(vec2 pos)","  {","    vec2 ret;","    ","    ","    float depth1 = sampleDepth(vec2(position.x-1.0, position.y-1.0));","    float depth2 = sampleDepth(vec2(position.x, position.y-1.0));","    float depth3 = sampleDepth(vec2(position.x+1.0, position.y-1.0));","    float depth4 = sampleDepth(vec2(position.x-1.0, position.y));","    float depth5 = sampleDepth(vec2(position.x, position.y));","    float depth6 = sampleDepth(vec2(position.x+1.0, position.y));","    float depth7 = sampleDepth(vec2(position.x-1.0, position.y+1.0));","    float depth8 = sampleDepth(vec2(position.x, position.y+1.0));","    float depth9 = sampleDepth(vec2(position.x+1.0, position.y+1.0));","    ","    float median1 = median(depth1, depth2, depth3);","    float median2 = median(depth4, depth5, depth6);","    float median3 = median(depth7, depth8, depth9);","    ","    ret.x = median(median1, median2, median3);","    ret.y = variance(depth1, depth2, depth3, depth4, depth5, depth6, depth7, depth8, depth9);","    ","    return ret;","    ","  }","","","void main() {","  ","  vUvP = vec2( position.x / (width*2.0), position.y / (height*2.0)+0.5 );","  colorP = vec2( position.x / (width*2.0)+0.5 , position.y / (height*2.0)  );","  ","  vec4 pos = vec4(0.0,0.0,0.0,0.0);","  depthVariance = 0.0;","  ","  if ( (vUvP.x<0.0)|| (vUvP.x>0.5) || (vUvP.y<0.5) || (vUvP.y>0.0))","  {","    vec2 smp = decodeDepth(vec2(position.x, position.y));","    float depth = smp.x;","    depthVariance = smp.y;","    ","    float z = -depth;","    ","    pos = vec4(","      ( position.x / width - 0.5 ) * z * 0.5 * maxDepthPerTile * resolutionFactor * (1000.0/focallength) * -1.0,","      ( position.y / height - 0.5 ) * z * 0.5 * maxDepthPerTile * resolutionFactor * (1000.0/focallength),","      (- z + zOffset / 1000.0) * maxDepthPerTile,","      1.0);","    ","    vec2 maskP = vec2( position.x / (width*2.0), position.y / (height*2.0)  );","    vec4 maskColor = texture2D( map, maskP );","    maskVal = ( maskColor.r + maskColor.g + maskColor.b ) / 3.0 ;","  }","  ","  gl_PointSize = pointSize;","  gl_Position = projectionMatrix * modelViewMatrix * pos;","  ","}"].join("\n"),this.fragment_shader=["uniform sampler2D map;","uniform float varianceThreshold;","uniform float whiteness;","","varying vec2 vUvP;","varying vec2 colorP;","","varying float depthVariance;","varying float maskVal;","","","void main() {","  ","  vec4 color;","  ","  if ( (depthVariance>varianceThreshold) || (maskVal>0.5) ||(vUvP.x<0.0)|| (vUvP.x>0.5) || (vUvP.y<0.5) || (vUvP.y>1.0))","  {  ","    discard;","  }","  else ","  {","    color = texture2D( map, colorP );","    ","    float fader = whiteness /100.0;","    ","    color.r = color.r * (1.0-fader)+ fader;","    ","    color.g = color.g * (1.0-fader)+ fader;","    ","    color.b = color.b * (1.0-fader)+ fader;","    ","    color.a = 1.0;//smoothstep( 20000.0, -20000.0, gl_FragCoord.z / gl_FragCoord.w );","  }","  ","  gl_FragColor = vec4( color.r, color.g, color.b, color.a );","  ","}"].join("\n")}metaLoaded(){this.metaLoaded=!0,this.initStreamer()}initStreamer(){if(this.metaLoaded){this.texture=new THREE.Texture(this.video),this.geometry=new THREE.Geometry;for(var e=0,t=this.width*this.height;e<t;e++){var s=new THREE.Vector3;s.x=e%this.width,s.y=Math.floor(e/this.width),this.geometry.vertices.push(s)}this.material=new THREE.ShaderMaterial({uniforms:{map:{type:"t",value:this.texture},width:{type:"f",value:this.width},height:{type:"f",value:this.height},focallength:{type:"f",value:this.f},pointSize:{type:"f",value:this.pointSize},zOffset:{type:"f",value:0},whiteness:{type:"f",value:this.whiteness},varianceThreshold:{type:"f",value:this.varianceThreshold},maxDepthPerTile:{type:"f",value:this.maxDepthPerTile},resolutionFactor:{type:"f",value:this.resolutionFactor}},vertexShader:this.vertex_shader,fragmentShader:this.fragment_shader}),this.mesh=new THREE.ParticleSystem(this.geometry,this.material),this.mesh.position.x=0,this.mesh.position.y=0,this.add(this.mesh);var i=this;setInterval((function(){(i.isMjpeg||i.video.readyState===i.video.HAVE_ENOUGH_DATA)&&(i.texture.needsUpdate=!0)}),1e3/30)}}startStream(){this.isMjpeg||this.video.play()}stopStream(){this.isMjpeg||this.video.pause()}}class i extends THREE.Object3D{constructor(e){super();var t=this,s=(e=e||{}).handle;this.name=s.name;var i=e.camera,o=e.path||"/",r=e.loader;this.dragging=!1,this.onServerSetPose({pose:s.pose}),this.dragStart={position:new THREE.Vector3,orientation:new THREE.Quaternion,positionWorld:new THREE.Vector3,orientationWorld:new THREE.Quaternion,event3d:{}},s.controls.forEach((function(e){t.add(new InteractiveMarkerControl({parent:t,handle:s,message:e,camera:i,path:o,loader:r}))})),s.menuEntries.length>0&&(this.menu=new InteractiveMarkerMenu({menuEntries:s.menuEntries,menuFontSize:s.menuFontSize}),this.menu.addEventListener("menu-select",(function(e){t.dispatchEvent(e)})))}showMenu(e,t){this.menu&&this.menu.show(e,t)}moveAxis(e,t,s){if(this.dragging){var i=e.currentControlOri,o=t.clone().applyQuaternion(i),r=this.dragStart.event3d.intersection.point,n=o.clone().applyQuaternion(this.dragStart.orientationWorld.clone()),a=new THREE.Ray(r,n),c=closestAxisPoint(a,s.camera,s.mousePos),h=new THREE.Vector3;h.addVectors(this.dragStart.position,o.clone().applyQuaternion(this.dragStart.orientation).multiplyScalar(c)),this.setPosition(e,h),s.stopPropagation()}}move3d(e,t,s){if(this.dragging)if(e.isShift);else{var i=e.camera.getWorldDirection(),o=Math.abs(i.x),r=Math.abs(i.y),n=Math.abs(i.z),a=new THREE.Quaternion(1,0,0,1);r>o&&r>n?a=new THREE.Quaternion(0,0,1,1):n>o&&n>r&&(a=new THREE.Quaternion(0,1,0,1)),a.normalize(),(t=new THREE.Vector3(1,0,0)).applyQuaternion(a),this.movePlane(e,t,s)}}movePlane(e,t,s){if(this.dragging){var i=e.currentControlOri,o=t.clone().applyQuaternion(i),r=this.dragStart.event3d.intersection.point,n=o.clone().applyQuaternion(this.dragStart.orientationWorld),a=intersectPlane(s.mouseRay,r,n),c=new THREE.Vector3;c.subVectors(a,r),c.add(this.dragStart.positionWorld),this.setPosition(e,c),s.stopPropagation()}}rotateAxis(e,t,s){if(this.dragging){e.updateMatrixWorld();var i=e.currentControlOri.clone().multiply(t.clone()),o=new THREE.Vector3(1,0,0).applyQuaternion(i),r=this.dragStart.event3d.intersection.point,n=o.applyQuaternion(this.dragStart.orientationWorld),a=intersectPlane(s.mouseRay,r,n),c=new THREE.Ray(this.dragStart.positionWorld,n),h=intersectPlane(c,r,n),l=this.dragStart.orientationWorld.clone().multiply(i).clone().inverse();a.sub(h),a.applyQuaternion(l);var p=this.dragStart.event3d.intersection.point.clone();p.sub(h),p.applyQuaternion(l);var d=Math.atan2(a.y,a.z),u=Math.atan2(p.y,p.z)-d,m=new THREE.Quaternion;m.setFromAxisAngle(o,u),this.setOrientation(e,m.multiply(this.dragStart.orientationWorld)),s.stopPropagation()}}feedbackEvent(e,t){this.dispatchEvent({type:e,position:this.position.clone(),orientation:this.quaternion.clone(),controlName:t.name})}startDrag(e,t){if(0===t.domEvent.button){t.stopPropagation(),this.dragging=!0,this.updateMatrixWorld(!0);var s=new THREE.Vector3;this.matrixWorld.decompose(this.dragStart.positionWorld,this.dragStart.orientationWorld,s),this.dragStart.position=this.position.clone(),this.dragStart.orientation=this.quaternion.clone(),this.dragStart.event3d=t,this.feedbackEvent("user-mousedown",e)}}stopDrag(e,t){0===t.domEvent.button&&(t.stopPropagation(),this.dragging=!1,this.dragStart.event3d={},this.onServerSetPose(this.bufferedPoseEvent),this.bufferedPoseEvent=void 0,this.feedbackEvent("user-mouseup",e))}buttonClick(e,t){t.stopPropagation(),this.feedbackEvent("user-button-click",e)}setPosition(e,t){this.position.copy(t),this.feedbackEvent("user-pose-change",e)}setOrientation(e,t){t.normalize(),this.quaternion.copy(t),this.feedbackEvent("user-pose-change",e)}onServerSetPose(e){if(void 0!==e)if(this.dragging)this.bufferedPoseEvent=e;else{var t=e.pose;this.position.copy(t.position),this.quaternion.copy(t.orientation),this.updateMatrixWorld(!0)}}dispose(){var e=this;this.children.forEach((function(t){t.children.forEach((function(e){e.dispose(),t.remove(e)})),e.remove(t)}))}}class o extends THREE.Object3D{constructor(e){super();var t=this;e=e||{},this.parent=e.parent;var s=e.handle,i=e.message;this.message=i,this.name=i.name,this.camera=e.camera,this.path=e.path||"/",this.loader=e.loader,this.dragging=!1,this.startMousePos=new THREE.Vector2,this.isShift=!1;var o=new THREE.Quaternion(i.orientation.x,i.orientation.y,i.orientation.z,i.orientation.w);o.normalize();var r=new THREE.Vector3(1,0,0);switch(r.applyQuaternion(o),this.currentControlOri=new THREE.Quaternion,i.interaction_mode){case INTERACTIVE_MARKER_MOVE_ROTATE_3D:case INTERACTIVE_MARKER_MOVE_3D:this.addEventListener("mousemove",this.parent.move3d.bind(this.parent,this,r));break;case INTERACTIVE_MARKER_MOVE_AXIS:this.addEventListener("mousemove",this.parent.moveAxis.bind(this.parent,this,r)),this.addEventListener("touchmove",this.parent.moveAxis.bind(this.parent,this,r));break;case INTERACTIVE_MARKER_ROTATE_AXIS:this.addEventListener("mousemove",this.parent.rotateAxis.bind(this.parent,this,o));break;case INTERACTIVE_MARKER_MOVE_PLANE:this.addEventListener("mousemove",this.parent.movePlane.bind(this.parent,this,r));break;case INTERACTIVE_MARKER_BUTTON:this.addEventListener("click",this.parent.buttonClick.bind(this.parent,this))}function n(e){e.stopPropagation()}i.interaction_mode!==INTERACTIVE_MARKER_NONE&&(this.addEventListener("mousedown",this.parent.startDrag.bind(this.parent,this)),this.addEventListener("mouseup",this.parent.stopDrag.bind(this.parent,this)),this.addEventListener("contextmenu",this.parent.showMenu.bind(this.parent,this)),this.addEventListener("mouseup",(function(e){0===t.startMousePos.distanceToSquared(e.mousePos)&&(e.type="contextmenu",t.dispatchEvent(e))})),this.addEventListener("mouseover",n),this.addEventListener("mouseout",n),this.addEventListener("click",n),this.addEventListener("mousedown",(function(e){t.startMousePos=e.mousePos})),this.addEventListener("touchstart",(function(e){1===e.domEvent.touches.length&&(e.type="mousedown",e.domEvent.button=0,t.dispatchEvent(e))})),this.addEventListener("touchmove",(function(e){1===e.domEvent.touches.length&&(e.type="mousemove",e.domEvent.button=0,t.dispatchEvent(e))})),this.addEventListener("touchend",(function(e){0===e.domEvent.touches.length&&(e.domEvent.button=0,e.type="mouseup",t.dispatchEvent(e),e.type="click",t.dispatchEvent(e))})),window.addEventListener("keydown",(function(e){16===e.keyCode&&(t.isShift=!0)})),window.addEventListener("keyup",(function(e){16===e.keyCode&&(t.isShift=!1)})));var a=new THREE.Quaternion,c=this.parent.position.clone().multiplyScalar(-1);switch(i.orientation_mode){case INTERACTIVE_MARKER_INHERIT:a=this.parent.quaternion.clone().inverse();break;case INTERACTIVE_MARKER_FIXED:case INTERACTIVE_MARKER_VIEW_FACING:break;default:console.error("Unkown orientation mode: "+i.orientation_mode)}var h=new ROSLIB.TFClient({ros:s.tfClient.ros,fixedFrame:s.message.header.frame_id,serverName:s.tfClient.serverName});i.markers.forEach((function(e){var s=function(s){var i=new Marker({message:e,path:t.path,loader:t.loader});if(null!==s){var o=new ROSLIB.Pose({position:i.position,orientation:i.quaternion});o.applyTransform(new ROSLIB.Transform(s));var r=new Marker({message:e,path:t.path,loader:t.loader});r.position.add(c),r.position.applyQuaternion(a),r.quaternion.multiplyQuaternions(a,r.quaternion);var n=new THREE.Vector3(r.position.x,r.position.y,r.position.z),l=new ROSLIB.Transform({translation:n,orientation:r.quaternion});o.applyTransform(l),i.setPose(o),i.updateMatrixWorld(),h.unsubscribe(e.header.frame_id)}t.add(i)};""!==e.header.frame_id?h.subscribe(e.header.frame_id,s):s(null)}))}updateMatrixWorld(e){var t=this,s=this.message;switch(s.orientation_mode){case INTERACTIVE_MARKER_INHERIT:super.updateMatrixWorld(e),t.currentControlOri.copy(t.quaternion),t.currentControlOri.normalize();break;case INTERACTIVE_MARKER_FIXED:t.quaternion.copy(t.parent.quaternion.clone().inverse()),t.updateMatrix(),t.matrixWorldNeedsUpdate=!0,super.updateMatrixWorld(e),t.currentControlOri.copy(t.quaternion);break;case INTERACTIVE_MARKER_VIEW_FACING:t.camera.updateMatrixWorld();var i=(new THREE.Matrix4).extractRotation(t.camera.matrixWorld),o=new THREE.Matrix4,r=.5*Math.PI,n=new THREE.Euler(-r,0,r);o.makeRotationFromEuler(n);var a=new THREE.Matrix4;a.getInverse(t.parent.matrixWorld),i.multiplyMatrices(i,o),i.multiplyMatrices(a,i),t.currentControlOri.setFromRotationMatrix(i),s.independent_marker_orientation||(t.quaternion.copy(t.currentControlOri),t.updateMatrix(),t.matrixWorldNeedsUpdate=!0),super.updateMatrixWorld(e);break;default:console.error("Unkown orientation mode: "+s.orientation_mode)}}}class r extends EventEmitter2{constructor(e){e=e||{},this.message=e.message,this.feedbackTopic=e.feedbackTopic,this.tfClient=e.tfClient,this.menuFontSize=e.menuFontSize||"0.8em",this.name=this.message.name,this.header=this.message.header,this.controls=this.message.controls,this.menuEntries=this.message.menu_entries,this.dragging=!1,this.timeoutHandle=null,this.tfTransform=new ROSLIB.Transform,this.pose=new ROSLIB.Pose,this.setPoseFromClientBound=this.setPoseFromClient.bind(this),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onButtonClickBound=this.onButtonClick.bind(this),this.onMenuSelectBound=this.onMenuSelect.bind(this),this.setPoseFromServer(this.message.pose),this.tfUpdateBound=this.tfUpdate.bind(this)}subscribeTf(){0===this.message.header.stamp.secs&&0===this.message.header.stamp.nsecs&&this.tfClient.subscribe(this.message.header.frame_id,this.tfUpdateBound)}unsubscribeTf(){this.tfClient.unsubscribe(this.message.header.frame_id,this.tfUpdateBound)}emitServerPoseUpdate(){var e=new ROSLIB.Pose(this.pose);e.applyTransform(this.tfTransform),this.emit("pose",e)}setPoseFromServer(e){this.pose=new ROSLIB.Pose(e),this.emitServerPoseUpdate()}tfUpdate(e){this.tfTransform=new ROSLIB.Transform(e),this.emitServerPoseUpdate()}setPoseFromClient(e){this.pose=new ROSLIB.Pose(e);var t=this.tfTransform.clone();t.rotation.invert(),t.translation.multiplyQuaternion(t.rotation),t.translation.x*=-1,t.translation.y*=-1,t.translation.z*=-1,this.pose.applyTransform(t),this.sendFeedback(INTERACTIVE_MARKER_POSE_UPDATE,void 0,0,e.controlName),this.dragging&&(this.timeoutHandle&&clearTimeout(this.timeoutHandle),this.timeoutHandle=setTimeout(this.setPoseFromClient.bind(this,e),250))}onButtonClick(e){this.sendFeedback(INTERACTIVE_MARKER_BUTTON_CLICK,e.clickPosition,0,e.controlName)}onMouseDown(e){this.sendFeedback(INTERACTIVE_MARKER_MOUSE_DOWN,e.clickPosition,0,e.controlName),this.dragging=!0}onMouseUp(e){this.sendFeedback(INTERACTIVE_MARKER_MOUSE_UP,e.clickPosition,0,e.controlName),this.dragging=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)}onMenuSelect(e){this.sendFeedback(INTERACTIVE_MARKER_MENU_SELECT,void 0,e.id,e.controlName)}sendFeedback(e,t,s,i){var o=void 0!==t;t=t||{x:0,y:0,z:0};var r={header:this.header,client_id:this.clientID,marker_name:this.name,control_name:i,event_type:e,pose:this.pose,mouse_point:t,mouse_point_valid:o,menu_entry_id:s};this.feedbackTopic.publish(r)}}class n extends THREE.EventDispatcher{constructor(e){super();var t=this,s=(e=e||{}).menuEntries,i=e.className||"default-interactive-marker-menu";e.entryClassName;var o,r,n,a=e.overlayClassName||"default-interactive-marker-overlay",c=e.menuFontSize||"0.8em",h=[];if(h[0]={children:[]},null===document.getElementById("default-interactive-marker-menu-css")){var l=document.createElement("style");l.id="default-interactive-marker-menu-css",l.type="text/css",l.innerHTML=".default-interactive-marker-menu {background-color: #444444;border: 1px solid #888888;border: 1px solid #888888;padding: 0px 0px 0px 0px;color: #FFFFFF;font-family: sans-serif;font-size: "+c+";z-index: 1002;}.default-interactive-marker-menu ul {padding: 0px 0px 5px 0px;margin: 0px;list-style-type: none;}.default-interactive-marker-menu ul li div {-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;cursor: default;padding: 3px 10px 3px 10px;}.default-interactive-marker-menu-entry:hover {  background-color: #666666;  cursor: pointer;}.default-interactive-marker-menu ul ul {  font-style: italic;  padding-left: 10px;}.default-interactive-marker-overlay {  position: absolute;  top: 0%;  left: 0%;  width: 100%;  height: 100%;  background-color: black;  z-index: 1001;  -moz-opacity: 0.0;  opacity: .0;  filter: alpha(opacity = 0);}",document.getElementsByTagName("head")[0].appendChild(l)}for(this.menuDomElem=document.createElement("div"),this.menuDomElem.style.position="absolute",this.menuDomElem.className=i,this.menuDomElem.addEventListener("contextmenu",(function(e){e.preventDefault()})),this.overlayDomElem=document.createElement("div"),this.overlayDomElem.className=a,this.hideListener=this.hide.bind(this),this.overlayDomElem.addEventListener("contextmenu",this.hideListener),this.overlayDomElem.addEventListener("click",this.hideListener),this.overlayDomElem.addEventListener("touchstart",this.hideListener),o=0;o<s.length;o++)h[n=(r=s[o]).id]={title:r.title,id:n,children:[]};for(o=0;o<s.length;o++){var p=h[n=(r=s[o]).id];h[r.parent_id].children.push(p)}function d(e,t){this.dispatchEvent({type:"menu-select",domEvent:t,id:e.id,controlName:this.controlName}),this.hide(t)}!function e(s,i){var o=document.createElement("ul");s.appendChild(o);for(var r=i.children,n=0;n<r.length;n++){var a=document.createElement("li"),c=document.createElement("div");c.appendChild(document.createTextNode(r[n].title)),o.appendChild(a),a.appendChild(c),r[n].children.length>0?(e(a,r[n]),c.addEventListener("click",t.hide.bind(t)),c.addEventListener("touchstart",t.hide.bind(t))):(c.addEventListener("click",d.bind(t,r[n])),c.addEventListener("touchstart",d.bind(t,r[n])),c.className="default-interactive-marker-menu-entry")}}(this.menuDomElem,h[0])}show(e,t){t&&t.preventDefault&&t.preventDefault(),this.controlName=e.name,void 0!==t.domEvent.changedTouches?(this.menuDomElem.style.left=t.domEvent.changedTouches[0].pageX+"px",this.menuDomElem.style.top=t.domEvent.changedTouches[0].pageY+"px"):(this.menuDomElem.style.left=t.domEvent.clientX+"px",this.menuDomElem.style.top=t.domEvent.clientY+"px"),document.body.appendChild(this.overlayDomElem),document.body.appendChild(this.menuDomElem)}hide(e){e&&e.preventDefault&&e.preventDefault(),document.body.removeChild(this.overlayDomElem),document.body.removeChild(this.menuDomElem)}}class a extends THREE.Object3D{constructor(e){super();var t=(e=e||{}).path||"/",s=e.message;"/"!==t.substr(t.length-1)&&(t+="/"),s.scale?this.msgScale=[s.scale.x,s.scale.y,s.scale.z]:this.msgScale=[1,1,1],this.msgColor=s.color,this.msgMesh=void 0,this.setPose(s.pose);var i=makeColorMaterial(this.msgColor.r,this.msgColor.g,this.msgColor.b,this.msgColor.a);switch(s.type){case MARKER_ARROW:var o,r=s.scale.x,n=.23*r,a=s.scale.y,c=.5*a,h=null;if(2===s.points.length){h=new THREE.Vector3(s.points[0].x,s.points[0].y,s.points[0].z);var l=new THREE.Vector3(s.points[1].x,s.points[1].y,s.points[1].z);r=(o=h.clone().negate().add(l)).length(),a=s.scale.y,c=s.scale.x,0!==s.scale.z&&(n=s.scale.z)}this.add(new Arrow({direction:o,origin:h,length:r,headLength:n,shaftDiameter:c,headDiameter:a,material:i}));break;case MARKER_CUBE:var p=new THREE.BoxGeometry(s.scale.x,s.scale.y,s.scale.z);this.add(new THREE.Mesh(p,i));break;case MARKER_SPHERE:var d=new THREE.SphereGeometry(.5),u=new THREE.Mesh(d,i);u.scale.x=s.scale.x,u.scale.y=s.scale.y,u.scale.z=s.scale.z,this.add(u);break;case MARKER_CYLINDER:var m=new THREE.CylinderGeometry(.5,.5,1,16,1,!1),E=new THREE.Mesh(m,i);E.quaternion.setFromAxisAngle(new THREE.Vector3(1,0,0),.5*Math.PI),E.scale.set(s.scale.x,s.scale.z,s.scale.y),this.add(E);break;case MARKER_LINE_STRIP:var v,g=new THREE.Geometry,f=new THREE.LineBasicMaterial({size:s.scale.x});for(v=0;v<s.points.length;v++){var T=new THREE.Vector3;T.x=s.points[v].x,T.y=s.points[v].y,T.z=s.points[v].z,g.vertices.push(T)}if(s.colors.length===s.points.length)for(f.vertexColors=!0,v=0;v<s.points.length;v++){var b=new THREE.Color;b.setRGB(s.colors[v].r,s.colors[v].g,s.colors[v].b),g.colors.push(b)}else f.color.setRGB(s.color.r,s.color.g,s.color.b);this.add(new THREE.Line(g,f));break;case MARKER_LINE_LIST:var R,y=new THREE.Geometry,w=new THREE.LineBasicMaterial({size:s.scale.x});for(R=0;R<s.points.length;R++){var M=new THREE.Vector3;M.x=s.points[R].x,M.y=s.points[R].y,M.z=s.points[R].z,y.vertices.push(M)}if(s.colors.length===s.points.length)for(w.vertexColors=!0,R=0;R<s.points.length;R++){var x=new THREE.Color;x.setRGB(s.colors[R].r,s.colors[R].g,s.colors[R].b),y.colors.push(x)}else w.color.setRGB(s.color.r,s.color.g,s.color.b);this.add(new THREE.Line(y,w,THREE.LinePieces));break;case MARKER_CUBE_LIST:var H,C,_,S,O=new THREE.Object3D,I=s.points.length,A=I===s.colors.length,k=Math.ceil(I/1250);for(H=0;H<I;H+=k)C=new THREE.BoxGeometry(s.scale.x,s.scale.y,s.scale.z),_=A?makeColorMaterial(s.colors[H].r,s.colors[H].g,s.colors[H].b,s.colors[H].a):i,(S=new THREE.Mesh(C,_)).position.x=s.points[H].x,S.position.y=s.points[H].y,S.position.z=s.points[H].z,O.add(S);this.add(O);break;case MARKER_SPHERE_LIST:var D,L,P,N,V=new THREE.Object3D,j=s.points.length,B=j===s.colors.length,z=Math.ceil(j/1250);for(D=0;D<j;D+=z)L=new THREE.SphereGeometry(.5,8,8),P=B?makeColorMaterial(s.colors[D].r,s.colors[D].g,s.colors[D].b,s.colors[D].a):i,(N=new THREE.Mesh(L,P)).scale.x=s.scale.x,N.scale.y=s.scale.y,N.scale.z=s.scale.z,N.position.x=s.points[D].x,N.position.y=s.points[D].y,N.position.z=s.points[D].z,V.add(N);this.add(V);break;case MARKER_POINTS:var F,U=new THREE.Geometry,K=new THREE.ParticleBasicMaterial({size:s.scale.x});for(F=0;F<s.points.length;F++){var G=new THREE.Vector3;G.x=s.points[F].x,G.y=s.points[F].y,G.z=s.points[F].z,U.vertices.push(G)}if(s.colors.length===s.points.length)for(K.vertexColors=!0,F=0;F<s.points.length;F++){var W=new THREE.Color;W.setRGB(s.colors[F].r,s.colors[F].g,s.colors[F].b),U.colors.push(W)}else K.color.setRGB(s.color.r,s.color.g,s.color.b);this.add(new THREE.ParticleSystem(U,K));break;case MARKER_TEXT_VIEW_FACING:if(s.text.length>0){var q=this.msgColor,Q=document.createElement("canvas"),X=Q.getContext("2d"),Y="normal 100px sans-serif";X.font=Y;var Z=X.measureText(s.text).width;Q.width=Z,Q.height=150,X.font=Y,X.fillStyle="rgba("+Math.round(255*q.r)+", "+Math.round(255*q.g)+", "+Math.round(255*q.b)+", "+q.a+")",X.textAlign="left",X.textBaseline="middle",X.fillText(s.text,0,Q.height/2);var J=new THREE.CanvasTexture(Q);J.generateMipmaps=!1,J.minFilter=THREE.LinearFilter;var $=new THREE.SpriteMaterial({map:J}),ee=new THREE.Sprite($),te=s.scale.z;ee.scale.set(Z/Q.height*te,te,1),this.add(ee)}break;case MARKER_MESH_RESOURCE:var se=null;0===s.color.r&&0===s.color.g&&0===s.color.b&&0===s.color.a||(se=i),this.msgMesh=s.mesh_resource.substr(10);var ie=new MeshResource({path:t,resource:this.msgMesh,material:se});this.add(ie);break;case MARKER_TRIANGLE_LIST:var oe=new TriangleList({material:i,vertices:s.points,colors:s.colors});oe.scale.set(s.scale.x,s.scale.y,s.scale.z),this.add(oe);break;default:console.error("Currently unsupported marker type: "+s.type)}}setPose(e){this.position.x=e.position.x,this.position.y=e.position.y,this.position.z=e.position.z,this.quaternion.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w),this.quaternion.normalize(),this.updateMatrixWorld()}update(e){if(this.setPose(e.pose),e.color.r!==this.msgColor.r||e.color.g!==this.msgColor.g||e.color.b!==this.msgColor.b||e.color.a!==this.msgColor.a){var t=makeColorMaterial(e.color.r,e.color.g,e.color.b,e.color.a);switch(e.type){case MARKER_LINE_STRIP:case MARKER_LINE_LIST:case MARKER_POINTS:break;case MARKER_ARROW:case MARKER_CUBE:case MARKER_SPHERE:case MARKER_CYLINDER:case MARKER_TRIANGLE_LIST:case MARKER_TEXT_VIEW_FACING:this.traverse((function(e){e instanceof THREE.Mesh&&(e.material=t)}));break;case MARKER_MESH_RESOURCE:var s=null;0===e.color.r&&0===e.color.g&&0===e.color.b&&0===e.color.a||(s=this.colorMaterial),this.traverse((function(e){e instanceof THREE.Mesh&&(e.material=s)}));break;case MARKER_CUBE_LIST:case MARKER_SPHERE_LIST:default:return!1}this.msgColor=e.color}var i=Math.abs(this.msgScale[0]-e.scale.x)>1e-6||Math.abs(this.msgScale[1]-e.scale.y)>1e-6||Math.abs(this.msgScale[2]-e.scale.z)>1e-6;switch(this.msgScale=[e.scale.x,e.scale.y,e.scale.z],e.type){case MARKER_CUBE:case MARKER_SPHERE:case MARKER_CYLINDER:if(i)return!1;break;case MARKER_TEXT_VIEW_FACING:if(i||this.text!==e.text)return!1;break;case MARKER_MESH_RESOURCE:if(e.mesh_resource.substr(10)!==this.msgMesh)return!1;if(i)return!1;break;case MARKER_ARROW:case MARKER_LINE_STRIP:case MARKER_LINE_LIST:case MARKER_CUBE_LIST:case MARKER_SPHERE_LIST:case MARKER_POINTS:case MARKER_TRIANGLE_LIST:return!1}return!0}dispose(){this.children.forEach((function(e){e instanceof MeshResource?e.children.forEach((function(t){void 0!==t.material&&t.material.dispose(),t.children.forEach((function(e){void 0!==e.geometry&&e.geometry.dispose(),void 0!==e.material&&e.material.dispose(),t.remove(e)})),e.remove(t)})):(void 0!==e.geometry&&e.geometry.dispose(),void 0!==e.material&&e.material.dispose()),e.parent.remove(e)}))}}class c extends EventEmitter2{constructor(e){e=e||{},this.ros=e.ros,this.topicName=e.topic,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new THREE.Object3D,this.path=e.path||"/",this.markers={},this.rosTopic=void 0,this.subscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,messageType:"visualization_msgs/MarkerArray",compression:"png"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){e.markers.forEach(function(e){var t=e.ns+e.id;if(0===e.action){var s=!1;if(t in this.markers&&((s=this.markers[t].children[0].update(e))||this.removeMarker(t)),!s){var i=new Marker({message:e,path:this.path});this.markers[t]=new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.markers[t])}}else if(1===e.action)console.warn('Received marker message with deprecated action identifier "1"');else if(2===e.action)this.removeMarker(t);else if(3===e.action){for(var o in this.markers)this.removeMarker(o);this.markers={}}else console.warn('Received marker message with unknown action identifier "'+e.action+'"')}.bind(this)),this.emit("change")}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}removeMarker(e){var t=this.markers[e];t&&(t.unsubscribeTf(),this.rootObject.remove(t),t.children.forEach((e=>{e.dispose()})),delete this.markers[e])}}class h extends EventEmitter2{constructor(e){e=e||{},this.ros=e.ros,this.topicName=e.topic,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new THREE.Object3D,this.path=e.path||"/",this.lifetime=e.lifetime||0,this.markers={},this.rosTopic=void 0,this.updatedTime={},this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}checkTime(e){if((new Date).getTime()-this.updatedTime[e]>this.lifetime)this.removeMarker(e),this.emit("change");else{var t=this;setTimeout((function(){t.checkTime(e)}),100)}}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,messageType:"visualization_msgs/Marker",compression:"png"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){var t=e.ns+e.id,s=this.markers[t];if(this.updatedTime[t]=(new Date).getTime(),s?this.removeMarker(t):this.lifetime&&this.checkTime(e.ns+e.id),0===e.action){var i=new Marker({message:e,path:this.path});this.markers[t]=new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.markers[t])}this.emit("change")}removeMarker(e){var t=this.markers[e];t&&(t.unsubscribeTf(),this.rootObject.remove(t),t.children.forEach((e=>{e.dispose()})),delete this.markers[e])}}class l extends THREE.Mesh{constructor(e){var t=(e=e||{}).origin||new THREE.Vector3(0,0,0),s=e.direction||new THREE.Vector3(1,0,0),i=e.length||1,o=e.headLength||.2,r=e.shaftDiameter||.05,n=e.headDiameter||.1,a=e.material||new THREE.MeshBasicMaterial,c=i-o,h=new THREE.CylinderGeometry(.5*r,.5*r,c,12,1),l=new THREE.Matrix4;l.setPosition(new THREE.Vector3(0,.5*c,0)),h.applyMatrix(l);var p=new THREE.CylinderGeometry(0,.5*n,o,12,1);l.setPosition(new THREE.Vector3(0,c+.5*o,0)),p.applyMatrix(l),h.merge(p),super(h,a),this.position.copy(t),this.setDirection(s)}setDirection(e){var t=new THREE.Vector3;0===e.x&&0===e.z?t.set(1,0,0):t.set(0,1,0).cross(e);var s=Math.acos(new THREE.Vector3(0,1,0).dot(e.clone().normalize()));this.matrix=(new THREE.Matrix4).makeRotationAxis(t.normalize(),s),this.rotation.setFromRotationMatrix(this.matrix,this.rotation.order)}setLength(e){this.scale.set(e,e,e)}setColor(e){this.material.color.setHex(e)}dispose(){void 0!==this.geometry&&this.geometry.dispose(),void 0!==this.material&&this.material.dispose()}}class p extends THREE.ArrowHelper{constructor(e){var t=(e=e||{}).origin||new THREE.Vector3(0,0,0),s=e.direction||new THREE.Vector3(1,0,0),i=e.length||1;e.headLength,e.shaftDiameter,e.headDiameter,e.material||new THREE.MeshBasicMaterial,super(s,t,i,16711680)}dispose(){void 0!==this.line&&(this.line.material.dispose(),this.line.geometry.dispose()),void 0!==this.cone&&(this.cone.material.dispose(),this.cone.geometry.dispose())}}class d extends THREE.Object3D{constructor(e){super();var t=this,s=(e=e||{}).shaftRadius||.008,i=e.headRadius||.023,o=e.headLength||.1,r=e.scale||1,n=e.lineType||"full",a=e.lineDashLength||.1;function c(e){var i=new THREE.Color;i.setRGB(e.x,e.y,e.z);var o=new THREE.MeshBasicMaterial({color:i.getHex()}),r=new THREE.Vector3;r.crossVectors(e,new THREE.Vector3(0,-1,0));var c=new THREE.Quaternion;c.setFromAxisAngle(r,.5*Math.PI);var h,l=new THREE.Mesh(t.headGeom,o);if(l.position.copy(e),l.position.multiplyScalar(.95),l.quaternion.copy(c),l.updateMatrix(),t.add(l),"dashed"===n)for(var p=a,d=0;p/2+3*p*d+p/2<=1;++d){var u=new THREE.CylinderGeometry(s,s,p);(h=new THREE.Mesh(u,o)).position.copy(e),h.position.multiplyScalar(p/2+3*p*d),h.quaternion.copy(c),h.updateMatrix(),t.add(h)}else"full"===n?((h=new THREE.Mesh(t.lineGeom,o)).position.copy(e),h.position.multiplyScalar(.45),h.quaternion.copy(c),h.updateMatrix(),t.add(h)):console.warn("[Axes]: Unsupported line type. Not drawing any axes.")}this.scale.set(r,r,r),this.lineGeom=new THREE.CylinderGeometry(s,s,1-o),this.headGeom=new THREE.CylinderGeometry(0,i,o),c(new THREE.Vector3(1,0,0)),c(new THREE.Vector3(0,1,0)),c(new THREE.Vector3(0,0,1))}}class u extends THREE.Object3D{constructor(e){var t=(e=e||{}).num_cells||10,s=e.color||"#cccccc",i=e.lineWidth||1,o=e.cellSize||1;super();for(var r=new THREE.LineBasicMaterial({color:s,linewidth:i}),n=0;n<=t;++n){var a=o*t/2,c=a-n*o,h=new THREE.Geometry;h.vertices.push(new THREE.Vector3(-a,c,0),new THREE.Vector3(a,c,0));var l=new THREE.Geometry;l.vertices.push(new THREE.Vector3(c,-a,0),new THREE.Vector3(c,a,0)),this.add(new THREE.Line(h,r)),this.add(new THREE.Line(l,r))}}}var m={onError:function(e){console.error(e)},loaders:{dae:function(e,t,s){const i=s.material,o=new THREE.ColladaLoader(s.loader);return o.log=function(t){e.warnings&&console.warn(t)},o.load(t,(function(t){null!==i&&t.scene.traverse((function(e){e instanceof THREE.Mesh&&void 0===e.material&&(e.material=i)})),e.add(t.scene)}),null,m.onError),o},obj:function(e,t,s){s.material;const i=new THREE.OBJLoader(s.loader);return i.log=function(t){e.warnings&&console.warn(t)},i.load(t,(function(o){const r=THREE.LoaderUtils.extractUrlBase(t);if(o.materialLibraries.length){const n=o.materialLibraries[0];new THREE.MTLLoader(s.loader).setPath(r).load(n,(function(s){s.preload(),function(s,i){s.setMaterials(i).load(t,(function(t){e.add(t)}),null,m.onError)}(i,s)}),null,m.onError)}else e.add(o)}),null,m.onError),i},stl:function(e,t,s){const i=s.material,o=new THREE.STLLoader(s.loader);return o.load(t,(function(t){var s;t.computeFaceNormals(),s=null!==i?new THREE.Mesh(t,i):new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:10066329})),e.add(s)}),null,m.onError),o}}};class E extends THREE.Object3D{constructor(e){super();var t=(e=e||{}).path||"/",s=e.resource;e.material,this.warnings=e.warnings,"/"!==t.substr(t.length-1)&&(t+="/");var i=t+s,o=i.substr(-3).toLowerCase(),r=MeshLoader.loaders[o];r?r(this,i,e):console.warn("Unsupported loader for file type: '"+o+"'")}}class v extends THREE.Object3D{constructor(e){var t=(e=e||{}).material||new THREE.MeshBasicMaterial,s=e.vertices,i=e.colors;super(),t.side=THREE.DoubleSide;var o,r,n=new THREE.Geometry;for(o=0;o<s.length;o++)n.vertices.push(new THREE.Vector3(s[o].x,s[o].y,s[o].z));if(i.length===s.length){for(o=0;o<s.length;o+=3){var a=new THREE.Face3(o,o+1,o+2);for(r=3*o;r<3*o+3;o++){var c=new THREE.Color;c.setRGB(i[o].r,i[o].g,i[o].b),a.vertexColors.push(c)}n.faces.push(a)}t.vertexColors=THREE.VertexColors}else if(i.length===s.length/3){for(o=0;o<s.length;o+=3){var h=new THREE.Face3(o,o+1,o+2);h.color.setRGB(i[o/3].r,i[o/3].g,i[o/3].b),n.faces.push(h)}t.vertexColors=THREE.FaceColors}else for(o=0;o<s.length;o+=3){var l=new THREE.Face3(o,o+1,o+2);n.faces.push(l)}n.computeBoundingBox(),n.computeBoundingSphere(),n.computeFaceNormals(),this.add(new THREE.Mesh(n,t))}setColor(e){this.mesh.material.color.setHex(e)}}class g extends THREE.Mesh{constructor(e){var t=(e=e||{}).message,s=e.opacity||1,i=e.color||{r:255,g:255,b:255,a:255},o=e.colorScheme||"raw",r=t.info,n=r.origin,a=r.width,c=r.height,h=new THREE.PlaneBufferGeometry(a,c),l=new Uint8Array(a*c*4),p=new THREE.DataTexture(l,a,c,THREE.RGBAFormat);p.flipY=!0,p.minFilter=THREE.NearestFilter,p.magFilter=THREE.NearestFilter,p.needsUpdate=!0;var d=new THREE.MeshBasicMaterial({map:p,transparent:s<1,opacity:s});d.side=THREE.DoubleSide,super(h,d),Object.assign(this,e),this.colorScheme=o,this.quaternion.copy(new THREE.Quaternion(n.orientation.x,n.orientation.y,n.orientation.z,n.orientation.w)),this.position.x=a*r.resolution/2+n.position.x,this.position.y=c*r.resolution/2+n.position.y,this.position.z=n.position.z,this.scale.x=r.resolution,this.scale.y=r.resolution;var u=t.data;this.color=i,this.material=d,this.texture=p;for(var m=0;m<c;m++)for(var E=0;E<a;E++){var v=c-m-1,g=E+v*a,f=this.getValue(g,v,E,u),T=(i=this.getColor(g,v,E,f),4*(E+m*a));l.set(i,T)}p.needsUpdate=!0}dispose(){this.material.dispose(),this.texture.dispose()}getValue(e,t,s,i){return i[e]}getColor(e,t,s,i){if("map"===this.colorScheme){if(i<0||i>100)return[112,137,134,255];var o=255-255*i/100;return[o,o,o,255]}return[i*this.color.r/255,i*this.color.g/255,i*this.color.b/255,255]}}class f extends EventEmitter2{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/map",this.compression=e.compression||"cbor",this.continuous=e.continuous,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new THREE.Object3D,this.offsetPose=e.offsetPose||new ROSLIB.Pose,this.color=e.color||{r:255,g:255,b:255},this.opacity=e.opacity||1,this.colorScheme=e.colorScheme||"raw",this.currentGrid=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,messageType:"nav_msgs/OccupancyGrid",queue_length:1,compression:this.compression}),this.sceneNode=null,this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){this.currentGrid&&(this.tfClient?(this.sceneNode.unsubscribeTf(),this.sceneNode.remove(this.currentGrid)):this.rootObject.remove(this.currentGrid),this.currentGrid.dispose());var t=new OccupancyGrid({message:e,color:this.color,opacity:this.opacity,colorScheme:this.colorScheme});this.tfClient?(this.currentGrid=t,null===this.sceneNode?(this.sceneNode=new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:t,pose:this.offsetPose}),this.rootObject.add(this.sceneNode)):this.sceneNode.add(this.currentGrid)):(this.sceneNode=this.currentGrid=t,this.rootObject.add(this.currentGrid)),this.emit("change"),this.continuous||this.rosTopic.unsubscribe(this.processMessage)}}class T extends THREE.Mesh{constructor(e){var t=(e=e||{}).message,s=t.info,i=s.origin,o=s.width,r=s.height,n=t.data,a=new THREE.PlaneBufferGeometry(o,r,o-1,r-1),c=new Uint8Array(n),h=new THREE.DataTexture(c,o,r,THREE.RedFormat),l={bumpTexture:{type:"t",value:h}},p=new THREE.ShaderMaterial({uniforms:l,vertexShader:"\n      precision highp float;\n      uniform sampler2D bumpTexture;\n      \n      varying float cellHeight;\n      \n      void main() {\n        vec4 bumpData = texture2D( bumpTexture, uv );  \n        float scaledData = bumpData.r * 255.0;\n        \n        if(abs(scaledData) < 0.00001)\n          cellHeight = 0.0;\n        else if(abs(scaledData - 1.0) < 0.00001)\n          cellHeight = -0.5;\n        else if (abs(scaledData - 255.0) < 0.00001)\n          cellHeight = 2.0;\n        else \n          cellHeight = ((scaledData - 2.0) / 252.0) * 2.5 - 0.5;\n           \n        // move the position along the normal\n        vec3 newPosition = position + normal * cellHeight;\n        \n        gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n      }\n    ",fragmentShader:"\n        precision highp float;\n        varying float cellHeight;\n        \n        // c.x hue, c.y saturation, c.z value\n        vec3 hsv2rgb(vec3 c);\n        vec3 hsv2rgb(vec3 c) {\n          vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n          vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n          return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n        }\n        \n        void main() {\n          float normalizedHeight = (cellHeight + 0.5) / 2.5;\n          vec3 hsv = vec3(1.0 - normalizedHeight, 0.95, 0.88);\n          \n          vec4 heightColor = vec4(hsv2rgb(hsv), 1.0);\n          //vec4 heightColor = vec4(normalizedHeight, 0.0, 1.0 -normalizedHeight, 1.0);\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) + heightColor;\n          \n          if( abs(cellHeight) < 0.00001 )\n            gl_FragColor.a = 0.0;\n        }\n    ",side:THREE.DoubleSide});p.transparent=!0,super(a,p),Object.assign(this,e),this.material=p,this.texture=h,h.needsUpdate=!0,this.quaternion.copy(new THREE.Quaternion(i.orientation.x,i.orientation.y,i.orientation.z,i.orientation.w)),this.position.x=o*s.resolution/2+i.position.x,this.position.y=r*s.resolution/2+i.position.y,this.position.z=i.position.z,this.scale.x=s.resolution,this.scale.y=s.resolution}dispose(){this.material.dispose(),this.texture.dispose()}}class b extends EventEmitter2{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"",this.compression=e.compression||"cbor",this.tfClient=e.tfClient,this.rootObject=e.rootObject||new THREE.Object3D,this.offsetPose=e.offsetPose||new ROSLIB.Pose,this.currentHeightMap=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,messageType:"nav_msgs/OccupancyGrid",queue_length:1,compression:this.compression}),this.sceneNode=null,this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){this.currentHeightMap&&(this.currentHeightMap.tfClient&&this.currentHeightMap.unsubscribeTf(),this.sceneNode&&this.sceneNode.remove(this.currentHeightMap),this.currentHeightMap.dispose());var t=new HeightMap({message:e});this.tfClient?(this.currentHeightMap=t,null===this.sceneNode?(this.sceneNode=new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:t,pose:this.offsetPose}),this.rootObject.add(this.sceneNode)):this.sceneNode.add(this.currentHeightMap)):(this.sceneNode=this.currentHeightMap=t,this.rootObject.add(this.currentHeightMap)),this.emit("change")}}class R extends OcTreeBase{constructor(e){super(e),this._defaultOccupiedValue=1,this._defaultFreeValue=-1,this.occupancyThreshold=void 0!==e.occupancyThreshold?e.occupancyThreshold:1e-7,this.useFlatColoring=void 0!==e.colorMode&&e.colorMode===OcTreeColorMode.SOLID,this.palette=void 0!==e.palette?e.palette.map((e=>new THREE.Color(e))):[{r:0,g:0,b:128},{r:0,g:255,b:0},{r:255,g:255,b:0},{r:255,g:128,b:0},{r:255,g:0,b:0}],this.paletteScale=void 0!==e.paletteScale?e.paletteScale:1}_readNodeData(e,t){t.value=e.readFloat32()}_obtainColor(e){if(this.useFlatColoring)return this.color;const t=1/(1+Math.exp(-e.value*this.paletteScale))*this.palette.length,s=Math.trunc(t),i=t-s;return s<0?this.palette[0]:s>=this.palette.length-1?this.palette[this.palette.length-1]:{r:i*this.palette[s].r+(1-i)*this.palette[s+1].r,g:i*this.palette[s].g+(1-i)*this.palette[s+1].g,b:i*this.palette[s].b+(1-i)*this.palette[s+1].b}}_checkOccupied(e){return e.value>=this.occupancyThreshold}}class y extends OcTree{constructor(e){super(e),this.useOwnColor=void 0!==e.palette&&e.colorMode===OcTreeColorMode.COLOR}_readNodeData(e,t){t.value=e.readFloat32(),t.color={r:e.readUint8(),g:e.readUint8(),b:e.readUint8()}}_obtainColor(e){return this.useOwnColor?e.color:OcTree.prototype._obtainColor.call(this,e)}}class w extends EventEmitter2{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/octomap",this.compression=e.compression||"cbor",this.continuous=e.continuous,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new THREE.Object3D,this.offsetPose=e.offsetPose||new ROSLIB.Pose,this.options={},void 0!==e.color&&(this.options.color=e.color),void 0!==e.opacity&&(this.options.opacity=e.opacity),void 0!==e.colorMode&&(this.options.colorMode=e.colorMode),void 0!==e.palette&&(this.options.palette=e.palette),void 0!==e.paletteScale&&(this.options.paletteScale=e.palette),void 0!==e.voxelRenderMode&&(this.options.voxelRenderMode=e.voxelRenderMode),this.currentMap=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,messageType:"octomap_msgs/Octomap",queue_length:1,compression:this.compression}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){this.currentMap&&this.currentMap.tfClient&&this.currentMap.unsubscribeTf(),this._processMessagePrivate(e),this.continuous||this.rosTopic.unsubscribe(this.processMessage)}_loadOcTree(e){return new Promise(function(t,s){const i=Object.assign({resolution:e.resolution},this.options);let o=null;if(e.binary)o=new OcTreeBase(i),o.readBinary(e.data);else{const t={OcTree:OcTree,ColorOcTree:ColorOcTree};e.id in t&&(console.log(e.id,t),o=new t[e.id](i),o.read(e.data))}o.buildGeometry(),t(o)}.bind(this))}_processMessagePrivate(e){this._loadOcTree(e).then(function(t){const s=this.sceneNode;this.tfClient?(this.currentMap=t,this.sceneNode=new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:t.object,pose:this.offsetPose})):(this.sceneNode=t.object,this.currentMap=t),this.rootObject.remove(s),this.rootObject.add(this.sceneNode),this.emit("change")}.bind(this))}}class M extends THREE.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/particlecloud",this.tfClient=e.tfClient,this.color=e.color||13369599,this.length=e.length||1,this.rootObject=e.rootObject||new THREE.Object3D,this.keep=e.keep||1,this.sns=[],this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"nav_msgs/Odometry"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){this.sns.length>=this.keep&&(this.sns[0].unsubscribeTf(),this.rootObject.remove(this.sns[0]),this.sns.shift()),this.options.origin=new THREE.Vector3(e.pose.pose.position.x,e.pose.pose.position.y,e.pose.pose.position.z);var t=new THREE.Quaternion(e.pose.pose.orientation.x,e.pose.pose.orientation.y,e.pose.pose.orientation.z,e.pose.pose.orientation.w);this.options.direction=new THREE.Vector3(1,0,0),this.options.direction.applyQuaternion(t),this.options.material=new THREE.MeshBasicMaterial({color:this.color});var s=new Arrow(this.options);this.sns.push(new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:s})),this.rootObject.add(this.sns[this.sns.length-1])}}class x extends THREE.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/path",this.tfClient=e.tfClient,this.color=e.color||13369599,this.opacity=e.opacity||1,this.lineWidth=e.lineWidth||1,this.rootObject=e.rootObject||new THREE.Object3D,this.sn=null,this.line=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"nav_msgs/Path"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));for(var t=new THREE.Geometry,s=0;s<e.poses.length;s++){var i=new THREE.Vector3(e.poses[s].pose.position.x,e.poses[s].pose.position.y,e.poses[s].pose.position.z);t.vertices.push(i)}t.computeLineDistances();var o=new THREE.LineBasicMaterial({color:this.color,opacity:this.opacity,linewidth:this.lineWidth});o.transparent=this.opacity<1;var r=new THREE.Line(t,o);this.sn=new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:r}),this.rootObject.add(this.sn)}}class H extends THREE.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/point",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new THREE.Object3D,this.radius=e.radius||.2,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PointStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));var t=new THREE.SphereGeometry(this.radius),s=new THREE.MeshBasicMaterial({color:this.color}),i=new THREE.Mesh(t,s);i.position.set(e.point.x,e.point.y,e.point.z),this.sn=new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.sn)}}class C extends THREE.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/path",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new THREE.Object3D,this.sn=null,this.line=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PolygonStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));for(var t,s=new THREE.Geometry,i=0;i<e.polygon.points.length;i++)t=new THREE.Vector3(e.polygon.points[i].x,e.polygon.points[i].y,e.polygon.points[i].z),s.vertices.push(t);t=new THREE.Vector3(e.polygon.points[0].x,e.polygon.points[0].y,e.polygon.points[0].z),s.vertices.push(t),s.computeLineDistances();var o=new THREE.LineBasicMaterial({color:this.color}),r=new THREE.Line(s,o);this.sn=new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:r}),this.rootObject.add(this.sn)}}class _ extends THREE.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/pose",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new THREE.Object3D,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PoseStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn)),this.options.origin=new THREE.Vector3(e.pose.position.x,e.pose.position.y,e.pose.position.z);var t=new THREE.Quaternion(e.pose.orientation.x,e.pose.orientation.y,e.pose.orientation.z,e.pose.orientation.w);this.options.direction=new THREE.Vector3(1,0,0),this.options.direction.applyQuaternion(t),this.options.material=new THREE.MeshBasicMaterial({color:this.color});var s=new Arrow(this.options);this.sn=new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:s}),this.rootObject.add(this.sn)}}class S extends THREE.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/particlecloud",this.tfClient=e.tfClient,this.color=e.color||13369599,this.length=e.length||1,this.rootObject=e.rootObject||new THREE.Object3D,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PoseArray"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));for(var t,s=new THREE.Object3D,i=0;i<e.poses.length;i++){var o=new THREE.Geometry,r=new THREE.Vector3(e.poses[i].position.x,e.poses[i].position.y,e.poses[i].position.z);o.vertices.push(r);var n=new THREE.Quaternion(e.poses[i].orientation.x,e.poses[i].orientation.y,e.poses[i].orientation.z,e.poses[i].orientation.w),a=new THREE.Vector3(this.length,0,0),c=new THREE.Vector3(.8*this.length,.2*this.length,0),h=new THREE.Vector3(.8*this.length,.2*-this.length,0);a.applyQuaternion(n),c.applyQuaternion(n),h.applyQuaternion(n),o.vertices.push(a.add(r)),o.vertices.push(c.add(r)),o.vertices.push(h.add(r)),o.vertices.push(a),o.computeLineDistances();var l=new THREE.LineBasicMaterial({color:this.color});t=new THREE.Line(o,l),s.add(t)}this.sn=new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:s}),this.rootObject.add(this.sn)}}class O extends THREE.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/PoseWithCovariance",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new THREE.Object3D,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PoseWithCovarianceStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn)),this.options.origin=new THREE.Vector3(e.pose.pose.position.x,e.pose.pose.position.y,e.pose.pose.position.z);var t=new THREE.Quaternion(e.pose.pose.orientation.x,e.pose.pose.orientation.y,e.pose.pose.orientation.z,e.pose.pose.orientation.w);this.options.direction=new THREE.Vector3(1,0,0),this.options.direction.applyQuaternion(t),this.options.material=new THREE.MeshBasicMaterial({color:this.color});var s=new Arrow(this.options);this.sn=new SceneNode({frameID:e.header.frame_id,tfClient:this.tfClient,object:s}),this.rootObject.add(this.sn)}}class I extends THREE.Object3D{constructor(e){e=e||{},this.ros=e.ros,this.topicName=e.topic||"/scan",this.compression=e.compression||"cbor",this.points=new Points(e),this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,compression:this.compression,queue_length:1,messageType:"sensor_msgs/LaserScan"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){if(this.points.setup(e.header.frame_id)){for(var t=e.ranges.length,s=0,i=0;i<t;i+=this.points.pointRatio){var o=e.ranges[i];if(o>=e.range_min&&o<=e.range_max){var r=e.angle_min+i*e.angle_increment;this.points.positions.array[s++]=o*Math.cos(r),this.points.positions.array[s++]=o*Math.sin(r),this.points.positions.array[s++]=0}}this.points.update(s/3)}}}class A extends THREE.Object3D{constructor(e){e=e||{},this.ros=e.ros,this.topicName=e.topic||"/gps/fix",this.rootObject=e.rootObject||new THREE.Object3D,this.object3d=e.object3d||new THREE.Object3D;var t=e.material||{};this.altitudeNaN=e.altitudeNaN||0,this.keep=e.keep||100,this.convert=e.convert||function(e,t,s){return new THREE.Vector3(e,t,s)},this.count=0,this.next1=0,this.next2=this.keep,this.geom=new THREE.BufferGeometry,this.vertices=new THREE.BufferAttribute(new Float32Array(6*this.keep),3),this.geom.addAttribute("position",this.vertices),this.material=t.isMaterial?t:new THREE.LineBasicMaterial(t),this.line=new THREE.Line(this.geom,this.material),this.rootObject.add(this.object3d),this.rootObject.add(this.line),this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"sensor_msgs/NavSatFix"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){var t=isNaN(e.altitude)?this.altitudeNaN:e.altitude,s=this.convert(e.longitude,e.latitude,t);this.object3d.position.copy(s),this.object3d.updateMatrixWorld(!0),this.vertices.array[3*this.next1]=s.x,this.vertices.array[3*this.next1+1]=s.y,this.vertices.array[3*this.next1+2]=s.z,this.vertices.array[3*this.next2]=s.x,this.vertices.array[3*this.next2+1]=s.y,this.vertices.array[3*this.next2+2]=s.z,this.vertices.needsUpdate=!0,this.next1=(this.next1+1)%this.keep,this.next2=this.next1+this.keep,this.count=Math.min(this.count+1,this.keep),this.geom.setDrawRange(this.next2-this.count,this.count)}}class k extends THREE.Object3D{constructor(e){super(),e=e||{},this.tfClient=e.tfClient,this.rootObject=e.rootObject||new THREE.Object3D,this.max_pts=e.max_pts||1e4,this.pointRatio=e.pointRatio||1,this.messageRatio=e.messageRatio||1,this.messageCount=0,this.material=e.material||{},this.colorsrc=e.colorsrc,this.colormap=e.colormap,("color"in e||"size"in e||"texture"in e)&&console.warn('toplevel "color", "size" and "texture" options are deprecated.They should beprovided within a "material" option, e.g. :  { tfClient, material : { color: mycolor, size: mysize, map: mytexture }, ... }'),this.sn=null}setup(e,t,s){if(null===this.sn){s=s||[],this.fields={};for(var i=0;i<s.length;i++)this.fields[s[i].name]=s[i];if(this.geom=new THREE.BufferGeometry,this.positions=new THREE.BufferAttribute(new Float32Array(3*this.max_pts),3,!1),this.geom.addAttribute("position",this.positions.setDynamic(!0)),!this.colorsrc&&this.fields.rgb&&(this.colorsrc="rgb"),this.colorsrc){var o=this.fields[this.colorsrc];if(o){this.colors=new THREE.BufferAttribute(new Float32Array(3*this.max_pts),3,!1),this.geom.addAttribute("color",this.colors.setDynamic(!0));var r=o.offset;this.getColor=[function(e,t,s){return e.getInt8(t+r,s)},function(e,t,s){return e.getUint8(t+r,s)},function(e,t,s){return e.getInt16(t+r,s)},function(e,t,s){return e.getUint16(t+r,s)},function(e,t,s){return e.getInt32(t+r,s)},function(e,t,s){return e.getUint32(t+r,s)},function(e,t,s){return e.getFloat32(t+r,s)},function(e,t,s){return e.getFloat64(t+r,s)}][o.datatype-1],this.colormap=this.colormap||function(e){return new THREE.Color(e)}}else console.warn('unavailable field "'+this.colorsrc+'" for coloring.')}this.material.isMaterial||(this.colors&&void 0===this.material.vertexColors&&(this.material.vertexColors=THREE.VertexColors),this.material=new THREE.PointsMaterial(this.material)),this.object=new THREE.Points(this.geom,this.material),this.sn=new SceneNode({frameID:e,tfClient:this.tfClient,object:this.object}),this.rootObject.add(this.sn)}return this.messageCount++%this.messageRatio==0}update(e){this.geom.setDrawRange(0,e),this.positions.needsUpdate=!0,this.positions.updateRange.count=e*this.positions.itemSize,this.colors&&(this.colors.needsUpdate=!0,this.colors.updateRange.count=e*this.colors.itemSize)}}function D(e,t,s,i){var o,r=0,n=0,a=0,c=e.length,h=t.length,l=((i=i||1)-1)*(s=s||h)*8;for(o=0;o<c&&a<h;o++)r=(r<<6)+D.e[e.charAt(o)],(n+=6)>=8&&(n-=8,t[a++]=r>>>n&255,a%s==0&&(o+=Math.ceil((l-n)/6),(n%=8)>0&&(r=D.e[e.charAt(o)])));return Math.floor(a/s)}D.S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D.e={};for(var L=0;L<64;L++)D.e[D.S.charAt(L)]=L;class P extends THREE.Object3D{constructor(e){e=e||{},this.ros=e.ros,this.topicName=e.topic||"/points",this.throttle_rate=e.throttle_rate||null,this.compression=e.compression||"cbor",this.max_pts=e.max_pts||1e4,this.applyColorTwice=e.applyColorTwice||!1,this.points=new Points(e),this.lastMessages=[],this.decayTime=e.decay||1,this.rosTopic=void 0,this.buffer=null,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe(this.processMessage)}subscribe(){this.unsubscribe(),this.rosTopic=new ROSLIB.Topic({ros:this.ros,name:this.topicName,messageType:"sensor_msgs/PointCloud2",throttle_rate:this.throttle_rate,queue_length:1,compression:this.compression}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){if(!this.points.setup(e.header.frame_id,e.point_step,e.fields))return;var t,s=this.points.pointRatio,i=this.max_pts*e.point_step;e.data.buffer?(this.buffer=e.data.slice(0,Math.min(e.data.byteLength,i)),t=Math.min(e.height*e.width/s,this.points.positions.array.length/3)):((!this.buffer||this.buffer.byteLength<i)&&(this.buffer=new Uint8Array(i)),t=D(e.data,this.buffer,e.point_step,s),s=1);for(var o,r,n=new DataView(this.buffer.buffer),a=!e.is_bigendian,c=this.points.fields.x.offset,h=this.points.fields.y.offset,l=this.points.fields.z.offset,p=t,d=new Array(p),u=this.points.colors?new Array(p):void 0,m=0;m<t;m++)o=m*s*e.point_step,d[3*m]=n.getFloat32(o+c,a),d[3*m+1]=n.getFloat32(o+h,a),d[3*m+2]=n.getFloat32(o+l,a),this.points.colors&&(r=this.points.colormap(this.points.getColor(n,o,a)),u[3*m]=r.r,u[3*m+1]=r.g,u[3*m+2]=r.b);if(this.applyColorTwice&&this.points.colors)for(m=0;m<t;m++)r=this.points.colormap(this.points.getColor(n,o,a)),u[3*m]=r.r,u[3*m+1]=r.g,u[3*m+2]=r.b;this.lastMessages.push({count:p,positions:d,colors:u}),this.lastMessages.length>this.decayTime&&(this.lastMessages=this.lastMessages.splice(this.lastMessages.length-this.decayTime));var E=this.points.positions.array.length;let v=0;for(m=this.lastMessages.length-1;m>=0&&v<E;m--)for(var g=this.lastMessages[m],f=0;f<g.count&&v<E;f++)this.points.positions.array[3*v+0]=g.positions[3*f+0],this.points.positions.array[3*v+1]=g.positions[3*f+1],this.points.positions.array[3*v+2]=g.positions[3*f+2],this.points.colors&&(this.points.colors.array[3*v+0]=g.colors[3*f+0],this.points.colors.array[3*v+1]=g.colors[3*f+1],this.points.colors.array[3*v+2]=g.colors[3*f+2]),v++;this.points.update(v)}}class N extends THREE.Object3D{constructor(e){super(),e=e||{},this.frame_id=e.frame_id,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new THREE.Object3D,this.axes=new Axes({shaftRadius:e.shaftRadius||.025,headRadius:e.headRaidus||.07,headLength:e.headLength||.2,scale:e.scale||1,lineType:e.lineType||"full",lineDashLength:e.lineDashLength||.1}),this.sn=new SceneNode({frameID:this.frame_id,tfClient:this.tfClient,object:this.axes}),this.rootObject.add(this.sn)}}class V extends THREE.Object3D{constructor(e){var t=(e=e||{}).urdfModel,s=e.path||"/",i=e.tfClient,o=e.tfPrefix||"",r=e.loader;super();var n=t.links;for(var a in n)for(var c=n[a],h=0;h<c.visuals.length;h++){var l=c.visuals[h];if(l&&l.geometry){var p=o+"/"+c.name,d=null;if(l.material&&l.material.color){var u=l.material&&l.material.color;d=makeColorMaterial(u.r,u.g,u.b,u.a)}if(l.geometry.type===ROSLIB.URDF_MESH){var m=l.geometry.filename,E=m.indexOf("package://");-1!==E&&(m=m.substr(E+"package://".length));var v=m.substr(-3).toLowerCase();if(MeshLoader.loaders[v]){var g=new MeshResource({path:s,resource:m,loader:r,material:d});c.visuals[h].geometry.scale&&g.scale.copy(l.geometry.scale);var f=new SceneNode({frameID:p,pose:l.origin,tfClient:i,object:g});f.name=l.name,this.add(f)}else console.warn("Could not load geometry mesh: "+m)}else{var T=this.createShapeMesh(l,e),b=new SceneNode({frameID:p,pose:l.origin,tfClient:i,object:T});b.name=l.name,this.add(b)}}}}createShapeMesh(e,t){var s,i=null;switch(i||(i=makeColorMaterial(0,0,0,1)),e.geometry.type){case ROSLIB.URDF_BOX:var o=e.geometry.dimension,r=new THREE.BoxGeometry(o.x,o.y,o.z);s=new THREE.Mesh(r,i);break;case ROSLIB.URDF_CYLINDER:var n=e.geometry.radius,a=e.geometry.length,c=new THREE.CylinderGeometry(n,n,a,16,1,!1);(s=new THREE.Mesh(c,i)).quaternion.setFromAxisAngle(new THREE.Vector3(1,0,0),.5*Math.PI);break;case ROSLIB.URDF_SPHERE:var h=new THREE.SphereGeometry(e.geometry.radius,16);s=new THREE.Mesh(h,i)}return s}unsubscribeTf(){this.children.forEach((function(e){"function"==typeof e.unsubscribeTf&&e.unsubscribeTf()}))}}class j extends THREE.EventDispatcher{constructor(e){super(),this.renderer=e.renderer,this.camera=e.camera,this.rootObject=e.rootObject,this.fallbackTarget=e.fallbackTarget,this.lastTarget=this.fallbackTarget,this.dragging=!1;this.listeners={},["contextmenu","click","dblclick","mouseout","mousedown","mouseup","mousemove","mousewheel","DOMMouseScroll","touchstart","touchend","touchcancel","touchleave","touchmove"].forEach((function(e){this.listeners[e]=this.processDomEvent.bind(this),this.renderer.domElement.addEventListener(e,this.listeners[e],!1)}),this)}processDomEvent(e){e.preventDefault();var t,s,i=e.target,o=i.getBoundingClientRect();if(-1!==e.type.indexOf("touch")){t=0,s=0;for(var r=0;r<e.touches.length;++r)t+=e.touches[r].clientX,s+=e.touches[r].clientY;t/=e.touches.length,s/=e.touches.length}else t=e.clientX,s=e.clientY;var n=t-o.left-i.clientLeft+i.scrollLeft,a=s-o.top-i.clientTop+i.scrollTop,c=n/i.clientWidth*2-1,h=-a/i.clientHeight*2+1,l=new THREE.Vector2(c,h),p=new THREE.Raycaster;p.params.Line.threshold=.001,p.setFromCamera(l,this.camera);var d={mousePos:l,mouseRay:p.ray,domEvent:e,camera:this.camera,intersection:this.lastIntersection};if("mouseout"===e.type)return this.dragging&&(this.notify(this.lastTarget,"mouseup",d),this.dragging=!1),this.notify(this.lastTarget,"mouseout",d),void(this.lastTarget=null);if("touchleave"===e.type||"touchend"===e.type)return this.dragging&&(this.notify(this.lastTarget,"mouseup",d),this.dragging=!1),this.notify(this.lastTarget,"touchend",d),void(this.lastTarget=null);if(this.dragging)return this.notify(this.lastTarget,e.type,d),void(("mouseup"===e.type&&2===e.button||"click"===e.type||"touchend"===e.type)&&(this.dragging=!1));i=this.lastTarget;var u;if((u=p.intersectObject(this.rootObject,!0)).length>0?(i=u[0].object,d.intersection=this.lastIntersection=u[0]):i=this.fallbackTarget,i!==this.lastTarget&&e.type.match(/mouse/)){var m=this.notify(i,"mouseover",d);0===m?this.notify(this.lastTarget,"mouseout",d):1===m&&(i=this.fallbackTarget)!==this.lastTarget&&(this.notify(i,"mouseover",d),this.notify(this.lastTarget,"mouseout",d))}i!==this.lastTarget&&e.type.match(/touch/)&&(this.notify(i,e.type,d)?(this.notify(this.lastTarget,"touchleave",d),this.notify(this.lastTarget,"touchend",d)):(i=this.fallbackTarget)!==this.lastTarget&&(this.notify(this.lastTarget,"touchmove",d),this.notify(this.lastTarget,"touchend",d)));this.notify(i,e.type,d),"mousedown"!==e.type&&"touchstart"!==e.type&&"touchmove"!==e.type||(this.dragging=!0),this.lastTarget=i}notify(e,t,s){for(s.type=t,s.cancelBubble=!1,s.continueBubble=!1,s.stopPropagation=function(){s.cancelBubble=!0},s.continuePropagation=function(){s.continueBubble=!0},s.currentTarget=e;s.currentTarget;){if(s.currentTarget.dispatchEvent&&s.currentTarget.dispatchEvent instanceof Function){if(s.currentTarget.dispatchEvent(s),s.cancelBubble)return this.dispatchEvent(s),0;if(s.continueBubble)return 2}s.currentTarget=s.currentTarget.parent}return 1}}class B extends THREE.EventDispatcher{constructor(e){super();var t=this,s=(e=e||{}).scene;this.camera=e.camera,this.center=new THREE.Vector3,this.userZoom=!0,this.userZoomSpeed=e.userZoomSpeed||1,this.userRotate=!0,this.userRotateSpeed=e.userRotateSpeed||1,this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed||2,this.displayPanAndZoomFrame=void 0===e.displayPanAndZoomFrame||!!e.displayPanAndZoomFrame,this.lineTypePanAndZoomFrame=e.dashedPanAndZoomFrame||"full",this.camera.up=new THREE.Vector3(0,0,1);var i=1800,o=new THREE.Vector2,r=new THREE.Vector2,n=new THREE.Vector2,a=new THREE.Vector2,c=new THREE.Vector2,h=new THREE.Vector2,l=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3,u=new THREE.Vector3,m=new Array(2),E=new Array(2);this.phiDelta=0,this.thetaDelta=0,this.scale=1,this.lastPosition=new THREE.Vector3;var v=-1,g=0,f=1,T=2,b=v;function R(e,t,s){var i=new THREE.Vector3;new THREE.Vector3;i.subVectors(t,e.origin);var o=e.direction.dot(s);if(Math.abs(o)<e.precision)return null;var r=s.dot(i)/o;return e.direction.clone().multiplyScalar(r)}function y(e){if(t.userZoom){var s=e.domEvent;(void 0!==s.wheelDelta?s.wheelDelta:-s.detail)>0?t.zoomIn():t.zoomOut(),this.showAxes()}}this.axes=new Axes({shaftRadius:.025,headRadius:.07,headLength:.2,lineType:this.lineTypePanAndZoomFrame}),this.displayPanAndZoomFrame&&(s.add(this.axes),this.axes.traverse((function(e){e.visible=!1}))),this.addEventListener("mousedown",(function(e){var s=e.domEvent;switch(s.preventDefault(),s.button){case 0:b=g,o.set(s.clientX,s.clientY);break;case 1:b=T,p=new THREE.Vector3(0,0,1);var i=(new THREE.Matrix4).extractRotation(this.camera.matrix);p.applyMatrix4(i),l=t.center.clone(),d=t.camera.position.clone(),u=R(e.mouseRay,l,p);break;case 2:b=f,a.set(s.clientX,s.clientY)}this.showAxes()})),this.addEventListener("mouseup",(function(e){t.userRotate&&(b=v)})),this.addEventListener("mousemove",(function(e){var s=e.domEvent;if(b===g)r.set(s.clientX,s.clientY),n.subVectors(r,o),t.rotateLeft(2*Math.PI*n.x/i*t.userRotateSpeed),t.rotateUp(2*Math.PI*n.y/i*t.userRotateSpeed),o.copy(r),this.showAxes();else if(b===f)c.set(s.clientX,s.clientY),h.subVectors(c,a),h.y>0?t.zoomIn():t.zoomOut(),a.copy(c),this.showAxes();else if(b===T){var m=R(e.mouseRay,t.center,p);if(!m)return;var E=(new THREE.Vector3).subVectors(u.clone(),m.clone());t.center.addVectors(l.clone(),E.clone()),t.camera.position.addVectors(d.clone(),E.clone()),t.update(),t.camera.updateMatrixWorld(),this.showAxes()}})),this.addEventListener("touchstart",(function(e){var s=e.domEvent;switch(s.touches.length){case 1:b=g,o.set(s.touches[0].pageX-window.scrollX,s.touches[0].pageY-window.scrollY);break;case 2:b=v,p=new THREE.Vector3(0,0,1);var i=(new THREE.Matrix4).extractRotation(this.camera.matrix);p.applyMatrix4(i),l=t.center.clone(),d=t.camera.position.clone(),u=R(e.mouseRay,l,p),m[0]=new THREE.Vector2(s.touches[0].pageX,s.touches[0].pageY),m[1]=new THREE.Vector2(s.touches[1].pageX,s.touches[1].pageY),E[0]=new THREE.Vector2(0,0),E[1]=new THREE.Vector2(0,0)}this.showAxes(),s.preventDefault()})),this.addEventListener("touchmove",(function(e){var s=e.domEvent;if(b===g)r.set(s.touches[0].pageX-window.scrollX,s.touches[0].pageY-window.scrollY),n.subVectors(r,o),t.rotateLeft(2*Math.PI*n.x/i*t.userRotateSpeed),t.rotateUp(2*Math.PI*n.y/i*t.userRotateSpeed),o.copy(r),this.showAxes();else{if(E[0].set(m[0].x-s.touches[0].pageX,m[0].y-s.touches[0].pageY),E[1].set(m[1].x-s.touches[1].pageX,m[1].y-s.touches[1].pageY),E[0].lengthSq()>10&&E[1].lengthSq()>10&&(m[0].set(s.touches[0].pageX,s.touches[0].pageY),m[1].set(s.touches[1].pageX,s.touches[1].pageY),E[0].dot(E[1])>0&&b!==f?b=T:E[0].dot(E[1])<0&&b!==T&&(b=f),b===f)){var a=new THREE.Vector2;a.subVectors(m[0],m[1]),E[0].dot(a)<0&&E[1].dot(a)>0?t.zoomOut():E[0].dot(a)>0&&E[1].dot(a)<0&&t.zoomIn()}if(b===T){var c=R(e.mouseRay,t.center,p);if(!c)return;var h=(new THREE.Vector3).subVectors(u.clone(),c.clone());t.center.addVectors(l.clone(),h.clone()),t.camera.position.addVectors(d.clone(),h.clone()),t.update(),t.camera.updateMatrixWorld()}this.showAxes(),s.preventDefault()}})),this.addEventListener("touchend",(function(e){var t=e.domEvent;1===t.touches.length&&b!==g?(b=g,o.set(t.touches[0].pageX-window.scrollX,t.touches[0].pageY-window.scrollY)):b=v})),this.addEventListener("mousewheel",y),this.addEventListener("DOMMouseScroll",y)}showAxes(){var e=this;this.axes.traverse((function(e){e.visible=!0})),this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout((function(){e.axes.traverse((function(e){e.visible=!1})),e.hideTimeout=!1}),1e3)}rotateLeft(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.thetaDelta-=e}rotateRight(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.thetaDelta+=e}rotateUp(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.phiDelta-=e}rotateDown(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.phiDelta+=e}zoomIn(e){void 0===e&&(e=Math.pow(.95,this.userZoomSpeed)),this.scale/=e}zoomOut(e){void 0===e&&(e=Math.pow(.95,this.userZoomSpeed)),this.scale*=e}update(){var e=this.camera.position,t=e.clone().sub(this.center),s=Math.atan2(t.y,t.x),i=Math.atan2(Math.sqrt(t.y*t.y+t.x*t.x),t.z);this.autoRotate&&this.rotateLeft(2*Math.PI/60/60*this.autoRotateSpeed),s+=this.thetaDelta,i+=this.phiDelta;var o=1e-6;i=Math.max(o,Math.min(Math.PI-o,i));var r=t.length();t.set(r*Math.sin(i)*Math.cos(s),r*Math.sin(i)*Math.sin(s),r*Math.cos(i)),t.multiplyScalar(this.scale),e.copy(this.center).add(t),this.camera.lookAt(this.center),r=t.length(),this.axes.position.copy(this.center),this.axes.scale.set(.05*r,.05*r,.05*r),this.axes.updateMatrixWorld(!0),this.thetaDelta=0,this.phiDelta=0,this.scale=1,this.lastPosition.distanceTo(this.camera.position)>0&&(this.dispatchEvent({type:"change"}),this.lastPosition.copy(this.camera.position))}}class z extends THREE.Object3D{constructor(e){super(),e=e||{};var t=this;this.tfClient=e.tfClient,this.frameID=e.frameID;var s=e.object;this.pose=e.pose||new ROSLIB.Pose,this.visible=!1,this.add(s),this.updatePose(this.pose),this.tfUpdate=function(e){var s=new ROSLIB.Transform(e),i=new ROSLIB.Pose(t.pose);i.applyTransform(s),t.updatePose(i),t.visible=!0},this.tfClient.subscribe(this.frameID,this.tfUpdate)}updatePose(e){this.position.set(e.position.x,e.position.y,e.position.z),this.quaternion.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w),this.updateMatrixWorld(!0)}unsubscribeTf(){this.tfClient.unsubscribe(this.frameID,this.tfUpdate)}}return e.Arrow=l,e.Arrow2=p,e.Axes=d,e.ColorOcTree=y,e.DepthCloud=s,e.Grid=u,e.HeightMap=T,e.HeightMapClient=b,e.Highlighter=class{constructor(e){e=e||{},this.mouseHandler=e.mouseHandler,this.hoverObjs={},this.mouseHandler.addEventListener("mouseover",this.onMouseOver.bind(this)),this.mouseHandler.addEventListener("mouseout",this.onMouseOut.bind(this))}onMouseOver(e){this.hoverObjs[e.currentTarget.uuid]=e.currentTarget}onMouseOut(e){var t=e.currentTarget.uuid;t in this.hoverObjs&&delete this.hoverObjs[t]}renderHighlights(e,t,s){this.makeEverythingInvisible(e),this.makeHighlightedVisible(e);var i=e.overrideMaterial;e.overrideMaterial=new THREE.MeshBasicMaterial({fog:!1,opacity:.5,transparent:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetUnits:-1,side:THREE.DoubleSide}),t.render(e,s),e.overrideMaterial=i,this.restoreVisibility(e)}makeEverythingInvisible(e){e.traverse((function(e){(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Sprite||e instanceof SceneNode)&&(e.previousVisibility=e.visible,e.visible=!1)}))}makeHighlightedVisible(e){var t=function(e){(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Sprite||e instanceof SceneNode)&&(e.visible=!0)};for(var s in this.hoverObjs){var i=this.hoverObjs[s];i.visible=!0,i.traverse(t)}}restoreVisibility(e){e.traverse(function(e){e.hasOwnProperty("previousVisibility")&&(e.visible=e.previousVisibility)}.bind(this))}},e.INTERACTIVE_MARKER_BUTTON=2,e.INTERACTIVE_MARKER_BUTTON_CLICK=3,e.INTERACTIVE_MARKER_FIXED=1,e.INTERACTIVE_MARKER_INHERIT=0,e.INTERACTIVE_MARKER_KEEP_ALIVE=0,e.INTERACTIVE_MARKER_MENU=1,e.INTERACTIVE_MARKER_MENU_SELECT=2,e.INTERACTIVE_MARKER_MOUSE_DOWN=4,e.INTERACTIVE_MARKER_MOUSE_UP=5,e.INTERACTIVE_MARKER_MOVE_3D=7,e.INTERACTIVE_MARKER_MOVE_AXIS=3,e.INTERACTIVE_MARKER_MOVE_PLANE=4,e.INTERACTIVE_MARKER_MOVE_ROTATE=6,e.INTERACTIVE_MARKER_MOVE_ROTATE_3D=9,e.INTERACTIVE_MARKER_NONE=0,e.INTERACTIVE_MARKER_POSE_UPDATE=1,e.INTERACTIVE_MARKER_ROTATE_3D=8,e.INTERACTIVE_MARKER_ROTATE_AXIS=5,e.INTERACTIVE_MARKER_VIEW_FACING=2,e.InteractiveMarker=i,e.InteractiveMarkerClient=class{constructor(e){e=e||{},this.ros=e.ros,this.tfClient=e.tfClient,this.topicName=e.topic,this.path=e.path||"/",this.camera=e.camera,this.rootObject=e.rootObject||new THREE.Object3D,this.loader=e.loader,this.menuFontSize=e.menuFontSize||"0.8em",this.interactiveMarkers={},this.updateTopic=null,this.feedbackTopic=null,this.topicName&&this.subscribe(this.topicName)}subscribe(e){this.unsubscribe(),this.updateTopic=new ROSLIB.Topic({ros:this.ros,name:e+"/tunneled/update",messageType:"visualization_msgs/InteractiveMarkerUpdate",compression:"png"}),this.updateTopic.subscribe(this.processUpdate.bind(this)),this.feedbackTopic=new ROSLIB.Topic({ros:this.ros,name:e+"/feedback",messageType:"visualization_msgs/InteractiveMarkerFeedback",compression:"png"}),this.feedbackTopic.advertise(),this.initService=new ROSLIB.Service({ros:this.ros,name:e+"/tunneled/get_init",serviceType:"demo_interactive_markers/GetInit"});var t=new ROSLIB.ServiceRequest({});this.initService.callService(t,this.processInit.bind(this))}unsubscribe(){for(var e in this.updateTopic&&this.updateTopic.unsubscribe(this.processUpdate),this.feedbackTopic&&this.feedbackTopic.unadvertise(),this.interactiveMarkers)this.eraseIntMarker(e);this.interactiveMarkers={}}processInit(e){var t=e.msg;for(var s in t.erases=[],this.interactiveMarkers)t.erases.push(s);t.poses=[],this.processUpdate(t)}processUpdate(e){var t=this;e.erases.forEach((function(e){t.eraseIntMarker(e)})),e.poses.forEach((function(e){var s=t.interactiveMarkers[e.name];s&&s.setPoseFromServer(e.pose)})),e.markers.forEach((function(e){var s=t.interactiveMarkers[e.name];s&&t.eraseIntMarker(s.name);var i=new InteractiveMarkerHandle({message:e,feedbackTopic:t.feedbackTopic,tfClient:t.tfClient,menuFontSize:t.menuFontSize});t.interactiveMarkers[e.name]=i;var o=new InteractiveMarker({handle:i,camera:t.camera,path:t.path,loader:t.loader});o.name=e.name,t.rootObject.add(o),i.on("pose",(function(e){o.onServerSetPose({pose:e})})),o.addEventListener("user-pose-change",i.setPoseFromClientBound),o.addEventListener("user-mousedown",i.onMouseDownBound),o.addEventListener("user-mouseup",i.onMouseUpBound),o.addEventListener("user-button-click",i.onButtonClickBound),o.addEventListener("menu-select",i.onMenuSelectBound),i.subscribeTf()}))}eraseIntMarker(e){if(this.interactiveMarkers[e]){var t=this.rootObject.getObjectByName(e);this.rootObject.remove(t);var s=this.interactiveMarkers[e];s.unsubscribeTf(),t.removeEventListener("user-pose-change",s.setPoseFromClientBound),t.removeEventListener("user-mousedown",s.onMouseDownBound),t.removeEventListener("user-mouseup",s.onMouseUpBound),t.removeEventListener("user-button-click",s.onButtonClickBound),t.removeEventListener("menu-select",s.onMenuSelectBound),delete this.interactiveMarkers[e],t.dispose()}}},e.InteractiveMarkerControl=o,e.InteractiveMarkerHandle=r,e.InteractiveMarkerMenu=n,e.LaserScan=I,e.MARKER_ARROW=0,e.MARKER_CUBE=1,e.MARKER_CUBE_LIST=6,e.MARKER_CYLINDER=3,e.MARKER_LINE_LIST=5,e.MARKER_LINE_STRIP=4,e.MARKER_MESH_RESOURCE=10,e.MARKER_POINTS=8,e.MARKER_SPHERE=2,e.MARKER_SPHERE_LIST=7,e.MARKER_TEXT_VIEW_FACING=9,e.MARKER_TRIANGLE_LIST=11,e.Marker=a,e.MarkerArrayClient=c,e.MarkerClient=h,e.MeshLoader=m,e.MeshResource=E,e.MouseHandler=j,e.NavSatFix=A,e.OcTree=R,e.OcTreeClient=w,e.OccupancyGrid=g,e.OccupancyGridClient=f,e.Odometry=M,e.OrbitControls=B,e.Path=x,e.Point=H,e.PointCloud2=P,e.Points=k,e.Polygon=C,e.Pose=_,e.PoseArray=S,e.PoseWithCovariance=O,e.REVISION="1.0.1",e.SceneNode=z,e.TFAxes=N,e.TriangleList=v,e.Urdf=V,e.UrdfClient=class{constructor(e){var t=this,s=(e=e||{}).ros;this.param=e.param||"robot_description",this.path=e.path||"/",this.tfClient=e.tfClient,this.rootObject=e.rootObject||new THREE.Object3D,this.tfPrefix=e.tfPrefix||"",this.loader=e.loader,new ROSLIB.Param({ros:s,name:this.param}).get((function(e){var s=new ROSLIB.UrdfModel({string:e});t.urdf=new Urdf({urdfModel:s,path:t.path,tfClient:t.tfClient,tfPrefix:t.tfPrefix,loader:t.loader}),t.rootObject.add(t.urdf)}))}},e.Viewer=class{constructor(e){var t=(e=e||{}).divID,s=e.elem,i=e.width,o=e.height,r=e.background||"#111111",n=e.antialias,a=e.intensity||.66,c=e.near||.01,h=e.far||1e3,l=e.alpha||1,p=e.cameraPose||{x:3,y:3,z:3},d=e.cameraZoomSpeed||.5,u=void 0===e.displayPanAndZoomFrame||!!e.displayPanAndZoomFrame,m=e.lineTypePanAndZoomFrame||"full";this.renderer=new THREE.WebGLRenderer({antialias:n,alpha:!0}),this.renderer.setClearColor(parseInt(r.replace("#","0x"),16),l),this.renderer.sortObjects=!1,this.renderer.setSize(i,o),this.renderer.shadowMap.enabled=!1,this.renderer.autoClear=!1,this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(40,i/o,c,h),this.camera.position.x=p.x,this.camera.position.y=p.y,this.camera.position.z=p.z,this.cameraControls=new OrbitControls({scene:this.scene,camera:this.camera,displayPanAndZoomFrame:u,lineTypePanAndZoomFrame:m}),this.cameraControls.userZoomSpeed=d,this.scene.add(new THREE.AmbientLight(5592405)),this.directionalLight=new THREE.DirectionalLight(16777215,a),this.scene.add(this.directionalLight),this.selectableObjects=new THREE.Group,this.scene.add(this.selectableObjects);var E=new MouseHandler({renderer:this.renderer,camera:this.camera,rootObject:this.selectableObjects,fallbackTarget:this.cameraControls});this.highlighter=new Highlighter({mouseHandler:E}),this.stopped=!0,this.animationRequestId=void 0,(s||document.getElementById(t)).appendChild(this.renderer.domElement),this.start()}start(){this.stopped=!1,this.draw()}draw(){this.stopped||(this.cameraControls.update(),this.directionalLight.position.normalize(),this.renderer.clear(!0,!0,!0),this.renderer.render(this.scene,this.camera),this.highlighter.renderHighlights(this.scene,this.renderer,this.camera),this.animationRequestId=requestAnimationFrame(this.draw.bind(this)))}stop(){this.stopped||cancelAnimationFrame(this.animationRequestId),this.stopped=!0}addObject(e,t){t?this.selectableObjects.add(e):this.scene.add(e)}resize(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}},e.closestAxisPoint=function(e,s,i){var o=e.origin.clone();o.project(s);var r=e.direction.clone().add(e.origin);r.project(s);var n=r.clone().sub(o),a=(new THREE.Vector2).subVectors(i,o).dot(n)/n.dot(n),c=new THREE.Vector2;c.addVectors(o,n.clone().multiplyScalar(a));var h=new THREE.Vector3(c.x,c.y,.5);h.unproject(s);var l=new THREE.Ray(s.position,h.sub(s.position).normalize());return t(e,l)},e.findClosestPoint=t,e.intersectPlane=function(e,t,s){var i=new THREE.Vector3,o=new THREE.Vector3;i.subVectors(t,e.origin);var r=e.direction.dot(s);if(!(Math.abs(r)<e.precision)){var n=s.dot(i)/r;return o.addVectors(e.origin,e.direction.clone().multiplyScalar(n)),o}},e.makeColorMaterial=function(e,t,s,i){var o=new THREE.Color;return o.setRGB(e,t,s),i<=.99?new THREE.MeshBasicMaterial({color:o.getHex(),opacity:i+.1,transparent:!0,depthWrite:!0,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneMinusSrcAlphaFactor,blendEquation:THREE.ReverseSubtractEquation,blending:THREE.NormalBlending}):new THREE.MeshPhongMaterial({color:o.getHex(),opacity:i,blending:THREE.NormalBlending})},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
